<div class="well">
  <div id="adyen-encrypted-form">
    <div class="margin-bottom">
      <% %w(amex mastercard visa elo diners).each do |flag_name| %>
        <%= image_tag "spree/payments/#{flag_name}-128px.png", class: "mini-thumb" %>
      <% end %>
    </div>
    <div class="row">
      <div class="col-md-6">
        <div class="row">
          <div class="col-sm-6 col-xs-12 col-md-12">
            <p class="field">
            <label for="adyen-encrypted-form-holder-name"><%= Spree.t(:name_on_card) %></label><span class="required">*</span>
            <input type="text" class="required form-control" value="<%= "#{@order.billing_firstname} #{@order.billing_lastname}" %>" autocomplete="off" data-encrypted-name="holderName" />
            </p>
          </div>
          <div class="col-sm-6 col-xs-12 col-md-12">
            <p class="field">
            <label for="adyen-encrypted-form-number"><%= Spree.t(:card_number) %></label><span class="required">*</span>
            <input type="text" class="required form-control cardNumber" maxlength="19" class="form-control" autocomplete="off" data-encrypted-name="number" />
            &nbsp;
            <span id="card_type" style="display:none;">
              ( <span id="looks_like" ><%= Spree.t(:card_type_is) %> <span id="type"></span></span>
              <span id="unrecognized"><%= Spree.t(:unrecognized_card_type) %></span>
              )
            </span>
            </p>
          </div>
        </div>
      </div>

      <div class="col-md-6">
        <% installments = payment_method.preferred_max_installments %>
        <% if installments %>
          <p class="field">
          <%= label_tag "installments", Spree.t(:installments) %><span class="required">*</span>
          <%= select_tag "payment_source[#{payment_method.id}][installments]", options_for_select(1..installments.to_i), class: "form-control" %>
          </p>
        <% end %>

        <div class="row">
          <div class="col-sm-8 margin-bottom">
            <div class="field">
              <%= label_tag "card_expiry", Spree.t(:expiration) %><span class="required">*</span>
              <div class="row">
                <div class="col-xs-6">
                  <input type="text" placeholder="MM (MÃªs)" class="required form-control" size="2" autocomplete="off" data-encrypted-name="expiryMonth" />
                </div>
                <div class="col-xs-6">
                  <input type="text" placeholder="YYYY (Ano)" class="required form-control" size="4" autocomplete="off" data-encrypted-name="expiryYear" />
                </div>
              </div>
            </div>
          </div>
          <div class="col-sm-4">
            <p class="field">
            <label for="adyen-encrypted-form-number"><%= Spree.t(:card_code) %> (CVV)</label><span class="required">*</span>
            <input type="text" class="form-control" size="4" maxlength="4" autocomplete="off" data-encrypted-name="cvc" />
            <%= link_to "(#{Spree.t(:what_is_this)})", spree.content_path('cvv'), :target => '_blank', "data-hook" => "cvv_link", :id => "cvv_link" %>
            </p>
          </div>
        </div>

        <input type="hidden" id="adyen-encrypted-form-expiry-generationtime" value="<%= DateTime.current() %>" data-encrypted-name="generationtime" />
      </div>
    </div>
  </div>

  <%= javascript_include_tag "adyen.encrypt.js" %>

  <script>
var form = document.getElementById('checkout_form_payment');
var key = "<%= payment_method.options[:public_key] %>";
var options = {
  'name': "<%= "payment_source[#{payment_method.id}][encrypted_data]" %>"
};
// the form will be encrypted before it is submitted
adyen.encrypt.createEncryptedForm(form, key, options);
  </script>

</div>

